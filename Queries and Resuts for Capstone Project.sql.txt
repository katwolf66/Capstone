#1 – The Data
SELECT *
FROM subscriptions
LIMIT 100;

id	subscription_start	subscription_end	segment
1	2016-12-01	2017-02-01	87
2	2016-12-01	2017-01-24	87
3	2016-12-01	2017-03-07	87
4	2016-12-01	2017-02-12	87
5	2016-12-01	2017-03-09	87
6	2016-12-01	2017-01-19	87
7	2016-12-01	2017-02-03	87
8	2016-12-01	2017-03-02	87
9	2016-12-01	2017-02-17	87
10	2016-12-01	2017-01-01	87
11	2016-12-01	2017-01-17	87
12	2016-12-01	2017-02-07	87
13	2016-12-01		30
14	2016-12-01	2017-03-07	30
15	2016-12-01	2017-02-22	30
16	2016-12-01		30
17	2016-12-01		30
18	2016-12-02	2017-01-29	87
19	2016-12-02	2017-01-13	87
20	2016-12-02	2017-01-15	87
21	2016-12-02	2017-01-15	87
22	2016-12-02	2017-01-24	87
23	2016-12-02	2017-01-14	87
24	2016-12-02	2017-01-18	87
25	2016-12-02	2017-02-24	87
26	2016-12-02	2017-01-18	87
27	2016-12-02	2017-01-11	87
28	2016-12-02	2017-03-30	30
29	2016-12-02	2017-02-11	30
30	2016-12-02	2017-01-20	30
31	2016-12-02		30
32	2016-12-02	2017-01-11	30
33	2016-12-02		30
34	2016-12-02	2017-02-06	30
35	2016-12-03	2017-02-17	87
36	2016-12-03	2017-03-06	87
37	2016-12-03	2017-03-08	87
38	2016-12-03	2017-02-28	87
39	2016-12-03		30
40	2016-12-03		30
41	2016-12-03		30
42	2016-12-03	2017-03-29	30
43	2016-12-03		30
44	2016-12-04	2017-03-11	87
45	2016-12-04	2017-02-02	87
46	2016-12-04	2017-02-18	87
47	2016-12-04	2017-02-06	87
48	2016-12-04	2017-03-12	87
49	2016-12-04	2017-03-06	87
50	2016-12-04	2017-02-15	87
51	2016-12-04	2017-01-06	87
52	2016-12-04	2017-02-21	87
53	2016-12-04	2017-01-31	87
54	2016-12-04	2017-03-08	87
55	2016-12-04	2017-02-21	87
56	2016-12-04		30
57	2016-12-04		30
58	2016-12-04		30
59	2016-12-04		30
60	2016-12-04		30
61	2016-12-04		30
62	2016-12-04	2017-03-11	30
63	2016-12-04	2017-01-14	30
64	2016-12-04		30
65	2016-12-04		30
66	2016-12-04		30
67	2016-12-04		30
68	2016-12-05	2017-01-13	87
69	2016-12-05	2017-02-15	87
70	2016-12-05	2017-03-12	87
71	2016-12-05	2017-01-13	87
72	2016-12-05	2017-01-29	87
73	2016-12-05	2017-01-20	87
74	2016-12-05	2017-01-09	87
75	2016-12-05	2017-02-25	87
76	2016-12-05	2017-01-28	87
77	2016-12-05	2017-02-09	87
78	2016-12-05	2017-01-23	87
79	2016-12-05	2017-01-27	87
80	2016-12-05	2017-01-11	87
81	2016-12-05		30
82	2016-12-05		30
83	2016-12-05		30
84	2016-12-05		30
85	2016-12-05		30
86	2016-12-05	2017-01-17	30
87	2016-12-05		30
88	2016-12-05	2017-03-26	30
89	2016-12-05		30
90	2016-12-06	2017-02-25	87
91	2016-12-06	2017-03-14	87
92	2016-12-06	2017-02-22	87
93	2016-12-06	2017-02-05	87
94	2016-12-06	2017-01-28	87
95	2016-12-06	2017-02-03	87
96	2016-12-06	2017-02-20	87
97	2016-12-06	2017-03-12	87
98	2016-12-06	2017-03-05	87
99	2016-12-06		30
100	2016-12-06	2017-03-11	30

#2 – The Data

Determine the Range of months

SELECT MIN(subscription_start) AS 'Start', MAX(subscription_end) AS 'End’
  FROM subscriptions;

Start	End
2016-12-01	2017-03-31

#3 – Create Temporary Table - Months

Create Months Table
WITH months as
(SELECT
  '2017-01-01' as first_day,
  '2017-01-31' as last_day
UNION
SELECT
  '2017-02-01' as first_day,
  '2017-02-28' as last_day
UNION
SELECT
  '2017-03-01' as first_day,
  '2017-03-31' as last_day
)
SELECT *
FROM months;

first_day	last_day
2017-01-01	2017-01-31
2017-02-01	2017-02-28
2017-03-01	2017-03-31

#4
Cross Join Subscriptions and Months
WITH months as
(SELECT
  '2017-01-01' as first_day,
  '2017-01-31' as last_day
UNION
SELECT
  '2017-02-01' as first_day,
  '2017-02-28' as last_day
UNION
SELECT
  '2017-03-01' as first_day,
  '2017-03-31' as last_day
),
cross_join AS
(SELECT *
FROM subscriptions
CROSS JOIN months)

SELECT *
FROM cross_join;
LIMIT 500;


id	subscription_start	subscription_end	segment	first_day	last_day
1	2016-12-01	2017-02-01	87	2017-01-01	2017-01-31
1	2016-12-01	2017-02-01	87	2017-02-01	2017-02-28
1	2016-12-01	2017-02-01	87	2017-03-01	2017-03-31
2	2016-12-01	2017-01-24	87	2017-01-01	2017-01-31
2	2016-12-01	2017-01-24	87	2017-02-01	2017-02-28
2	2016-12-01	2017-01-24	87	2017-03-01	2017-03-31
3	2016-12-01	2017-03-07	87	2017-01-01	2017-01-31
3	2016-12-01	2017-03-07	87	2017-02-01	2017-02-28
3	2016-12-01	2017-03-07	87	2017-03-01	2017-03-31
4	2016-12-01	2017-02-12	87	2017-01-01	2017-01-31
4	2016-12-01	2017-02-12	87	2017-02-01	2017-02-28
4	2016-12-01	2017-02-12	87	2017-03-01	2017-03-31
5	2016-12-01	2017-03-09	87	2017-01-01	2017-01-31
5	2016-12-01	2017-03-09	87	2017-02-01	2017-02-28
5	2016-12-01	2017-03-09	87	2017-03-01	2017-03-31
6	2016-12-01	2017-01-19	87	2017-01-01	2017-01-31
6	2016-12-01	2017-01-19	87	2017-02-01	2017-02-28
6	2016-12-01	2017-01-19	87	2017-03-01	2017-03-31
7	2016-12-01	2017-02-03	87	2017-01-01	2017-01-31
7	2016-12-01	2017-02-03	87	2017-02-01	2017-02-28
7	2016-12-01	2017-02-03	87	2017-03-01	2017-03-31
8	2016-12-01	2017-03-02	87	2017-01-01	2017-01-31
8	2016-12-01	2017-03-02	87	2017-02-01	2017-02-28
8	2016-12-01	2017-03-02	87	2017-03-01	2017-03-31
9	2016-12-01	2017-02-17	87	2017-01-01	2017-01-31
9	2016-12-01	2017-02-17	87	2017-02-01	2017-02-28
9	2016-12-01	2017-02-17	87	2017-03-01	2017-03-31
10	2016-12-01	2017-01-01	87	2017-01-01	2017-01-31
10	2016-12-01	2017-01-01	87	2017-02-01	2017-02-28
10	2016-12-01	2017-01-01	87	2017-03-01	2017-03-31
11	2016-12-01	2017-01-17	87	2017-01-01	2017-01-31
11	2016-12-01	2017-01-17	87	2017-02-01	2017-02-28
11	2016-12-01	2017-01-17	87	2017-03-01	2017-03-31
12	2016-12-01	2017-02-07	87	2017-01-01	2017-01-31
12	2016-12-01	2017-02-07	87	2017-02-01	2017-02-28
12	2016-12-01	2017-02-07	87	2017-03-01	2017-03-31
13	2016-12-01		30	2017-01-01	2017-01-31
13	2016-12-01		30	2017-02-01	2017-02-28
13	2016-12-01		30	2017-03-01	2017-03-31
14	2016-12-01	2017-03-07	30	2017-01-01	2017-01-31
14	2016-12-01	2017-03-07	30	2017-02-01	2017-02-28
14	2016-12-01	2017-03-07	30	2017-03-01	2017-03-31
15	2016-12-01	2017-02-22	30	2017-01-01	2017-01-31
15	2016-12-01	2017-02-22	30	2017-02-01	2017-02-28
15	2016-12-01	2017-02-22	30	2017-03-01	2017-03-31
16	2016-12-01		30	2017-01-01	2017-01-31
16	2016-12-01		30	2017-02-01	2017-02-28
16	2016-12-01		30	2017-03-01	2017-03-31
17	2016-12-01		30	2017-01-01	2017-01-31
17	2016-12-01		30	2017-02-01	2017-02-28
17	2016-12-01		30	2017-03-01	2017-03-31
18	2016-12-02	2017-01-29	87	2017-01-01	2017-01-31
18	2016-12-02	2017-01-29	87	2017-02-01	2017-02-28
18	2016-12-02	2017-01-29	87	2017-03-01	2017-03-31
19	2016-12-02	2017-01-13	87	2017-01-01	2017-01-31
19	2016-12-02	2017-01-13	87	2017-02-01	2017-02-28
19	2016-12-02	2017-01-13	87	2017-03-01	2017-03-31
20	2016-12-02	2017-01-15	87	2017-01-01	2017-01-31
20	2016-12-02	2017-01-15	87	2017-02-01	2017-02-28
20	2016-12-02	2017-01-15	87	2017-03-01	2017-03-31
21	2016-12-02	2017-01-15	87	2017-01-01	2017-01-31
21	2016-12-02	2017-01-15	87	2017-02-01	2017-02-28
21	2016-12-02	2017-01-15	87	2017-03-01	2017-03-31
22	2016-12-02	2017-01-24	87	2017-01-01	2017-01-31
22	2016-12-02	2017-01-24	87	2017-02-01	2017-02-28
22	2016-12-02	2017-01-24	87	2017-03-01	2017-03-31
23	2016-12-02	2017-01-14	87	2017-01-01	2017-01-31
23	2016-12-02	2017-01-14	87	2017-02-01	2017-02-28
23	2016-12-02	2017-01-14	87	2017-03-01	2017-03-31
24	2016-12-02	2017-01-18	87	2017-01-01	2017-01-31
24	2016-12-02	2017-01-18	87	2017-02-01	2017-02-28
24	2016-12-02	2017-01-18	87	2017-03-01	2017-03-31
25	2016-12-02	2017-02-24	87	2017-01-01	2017-01-31
25	2016-12-02	2017-02-24	87	2017-02-01	2017-02-28
25	2016-12-02	2017-02-24	87	2017-03-01	2017-03-31
26	2016-12-02	2017-01-18	87	2017-01-01	2017-01-31
26	2016-12-02	2017-01-18	87	2017-02-01	2017-02-28
26	2016-12-02	2017-01-18	87	2017-03-01	2017-03-31
27	2016-12-02	2017-01-11	87	2017-01-01	2017-01-31
27	2016-12-02	2017-01-11	87	2017-02-01	2017-02-28
27	2016-12-02	2017-01-11	87	2017-03-01	2017-03-31
28	2016-12-02	2017-03-30	30	2017-01-01	2017-01-31
28	2016-12-02	2017-03-30	30	2017-02-01	2017-02-28
28	2016-12-02	2017-03-30	30	2017-03-01	2017-03-31
29	2016-12-02	2017-02-11	30	2017-01-01	2017-01-31
29	2016-12-02	2017-02-11	30	2017-02-01	2017-02-28
29	2016-12-02	2017-02-11	30	2017-03-01	2017-03-31
30	2016-12-02	2017-01-20	30	2017-01-01	2017-01-31
30	2016-12-02	2017-01-20	30	2017-02-01	2017-02-28
30	2016-12-02	2017-01-20	30	2017-03-01	2017-03-31
31	2016-12-02		30	2017-01-01	2017-01-31
31	2016-12-02		30	2017-02-01	2017-02-28
31	2016-12-02		30	2017-03-01	2017-03-31
32	2016-12-02	2017-01-11	30	2017-01-01	2017-01-31
32	2016-12-02	2017-01-11	30	2017-02-01	2017-02-28
32	2016-12-02	2017-01-11	30	2017-03-01	2017-03-31
33	2016-12-02		30	2017-01-01	2017-01-31
33	2016-12-02		30	2017-02-01	2017-02-28
33	2016-12-02		30	2017-03-01	2017-03-31
34	2016-12-02	2017-02-06	30	2017-01-01	2017-01-31
34	2016-12-02	2017-02-06	30	2017-02-01	2017-02-28
34	2016-12-02	2017-02-06	30	2017-03-01	2017-03-31
35	2016-12-03	2017-02-17	87	2017-01-01	2017-01-31
35	2016-12-03	2017-02-17	87	2017-02-01	2017-02-28
35	2016-12-03	2017-02-17	87	2017-03-01	2017-03-31
36	2016-12-03	2017-03-06	87	2017-01-01	2017-01-31
36	2016-12-03	2017-03-06	87	2017-02-01	2017-02-28
36	2016-12-03	2017-03-06	87	2017-03-01	2017-03-31
37	2016-12-03	2017-03-08	87	2017-01-01	2017-01-31
37	2016-12-03	2017-03-08	87	2017-02-01	2017-02-28
37	2016-12-03	2017-03-08	87	2017-03-01	2017-03-31
38	2016-12-03	2017-02-28	87	2017-01-01	2017-01-31
38	2016-12-03	2017-02-28	87	2017-02-01	2017-02-28
38	2016-12-03	2017-02-28	87	2017-03-01	2017-03-31
39	2016-12-03		30	2017-01-01	2017-01-31
39	2016-12-03		30	2017-02-01	2017-02-28
39	2016-12-03		30	2017-03-01	2017-03-31
40	2016-12-03		30	2017-01-01	2017-01-31
40	2016-12-03		30	2017-02-01	2017-02-28
40	2016-12-03		30	2017-03-01	2017-03-31
41	2016-12-03		30	2017-01-01	2017-01-31
41	2016-12-03		30	2017-02-01	2017-02-28
41	2016-12-03		30	2017-03-01	2017-03-31
42	2016-12-03	2017-03-29	30	2017-01-01	2017-01-31
42	2016-12-03	2017-03-29	30	2017-02-01	2017-02-28
42	2016-12-03	2017-03-29	30	2017-03-01	2017-03-31
43	2016-12-03		30	2017-01-01	2017-01-31
43	2016-12-03		30	2017-02-01	2017-02-28
43	2016-12-03		30	2017-03-01	2017-03-31
44	2016-12-04	2017-03-11	87	2017-01-01	2017-01-31
44	2016-12-04	2017-03-11	87	2017-02-01	2017-02-28
44	2016-12-04	2017-03-11	87	2017-03-01	2017-03-31
45	2016-12-04	2017-02-02	87	2017-01-01	2017-01-31
45	2016-12-04	2017-02-02	87	2017-02-01	2017-02-28
45	2016-12-04	2017-02-02	87	2017-03-01	2017-03-31
46	2016-12-04	2017-02-18	87	2017-01-01	2017-01-31
46	2016-12-04	2017-02-18	87	2017-02-01	2017-02-28
46	2016-12-04	2017-02-18	87	2017-03-01	2017-03-31
47	2016-12-04	2017-02-06	87	2017-01-01	2017-01-31
47	2016-12-04	2017-02-06	87	2017-02-01	2017-02-28
47	2016-12-04	2017-02-06	87	2017-03-01	2017-03-31
48	2016-12-04	2017-03-12	87	2017-01-01	2017-01-31
48	2016-12-04	2017-03-12	87	2017-02-01	2017-02-28
48	2016-12-04	2017-03-12	87	2017-03-01	2017-03-31
49	2016-12-04	2017-03-06	87	2017-01-01	2017-01-31
49	2016-12-04	2017-03-06	87	2017-02-01	2017-02-28
49	2016-12-04	2017-03-06	87	2017-03-01	2017-03-31
50	2016-12-04	2017-02-15	87	2017-01-01	2017-01-31
50	2016-12-04	2017-02-15	87	2017-02-01	2017-02-28
50	2016-12-04	2017-02-15	87	2017-03-01	2017-03-31
51	2016-12-04	2017-01-06	87	2017-01-01	2017-01-31
51	2016-12-04	2017-01-06	87	2017-02-01	2017-02-28
51	2016-12-04	2017-01-06	87	2017-03-01	2017-03-31
52	2016-12-04	2017-02-21	87	2017-01-01	2017-01-31
52	2016-12-04	2017-02-21	87	2017-02-01	2017-02-28
52	2016-12-04	2017-02-21	87	2017-03-01	2017-03-31
53	2016-12-04	2017-01-31	87	2017-01-01	2017-01-31
53	2016-12-04	2017-01-31	87	2017-02-01	2017-02-28
53	2016-12-04	2017-01-31	87	2017-03-01	2017-03-31
54	2016-12-04	2017-03-08	87	2017-01-01	2017-01-31
54	2016-12-04	2017-03-08	87	2017-02-01	2017-02-28
54	2016-12-04	2017-03-08	87	2017-03-01	2017-03-31
55	2016-12-04	2017-02-21	87	2017-01-01	2017-01-31
55	2016-12-04	2017-02-21	87	2017-02-01	2017-02-28
55	2016-12-04	2017-02-21	87	2017-03-01	2017-03-31
56	2016-12-04		30	2017-01-01	2017-01-31
56	2016-12-04		30	2017-02-01	2017-02-28
56	2016-12-04		30	2017-03-01	2017-03-31
57	2016-12-04		30	2017-01-01	2017-01-31
57	2016-12-04		30	2017-02-01	2017-02-28
57	2016-12-04		30	2017-03-01	2017-03-31
58	2016-12-04		30	2017-01-01	2017-01-31
58	2016-12-04		30	2017-02-01	2017-02-28
58	2016-12-04		30	2017-03-01	2017-03-31
59	2016-12-04		30	2017-01-01	2017-01-31
59	2016-12-04		30	2017-02-01	2017-02-28
59	2016-12-04		30	2017-03-01	2017-03-31
60	2016-12-04		30	2017-01-01	2017-01-31
60	2016-12-04		30	2017-02-01	2017-02-28
60	2016-12-04		30	2017-03-01	2017-03-31
61	2016-12-04		30	2017-01-01	2017-01-31
61	2016-12-04		30	2017-02-01	2017-02-28
61	2016-12-04		30	2017-03-01	2017-03-31
62	2016-12-04	2017-03-11	30	2017-01-01	2017-01-31
62	2016-12-04	2017-03-11	30	2017-02-01	2017-02-28
62	2016-12-04	2017-03-11	30	2017-03-01	2017-03-31
63	2016-12-04	2017-01-14	30	2017-01-01	2017-01-31
63	2016-12-04	2017-01-14	30	2017-02-01	2017-02-28
63	2016-12-04	2017-01-14	30	2017-03-01	2017-03-31
64	2016-12-04		30	2017-01-01	2017-01-31
64	2016-12-04		30	2017-02-01	2017-02-28
64	2016-12-04		30	2017-03-01	2017-03-31
65	2016-12-04		30	2017-01-01	2017-01-31
65	2016-12-04		30	2017-02-01	2017-02-28
65	2016-12-04		30	2017-03-01	2017-03-31
66	2016-12-04		30	2017-01-01	2017-01-31
66	2016-12-04		30	2017-02-01	2017-02-28
66	2016-12-04		30	2017-03-01	2017-03-31
67	2016-12-04		30	2017-01-01	2017-01-31
67	2016-12-04		30	2017-02-01	2017-02-28
67	2016-12-04		30	2017-03-01	2017-03-31
68	2016-12-05	2017-01-13	87	2017-01-01	2017-01-31
68	2016-12-05	2017-01-13	87	2017-02-01	2017-02-28
68	2016-12-05	2017-01-13	87	2017-03-01	2017-03-31
69	2016-12-05	2017-02-15	87	2017-01-01	2017-01-31
69	2016-12-05	2017-02-15	87	2017-02-01	2017-02-28
69	2016-12-05	2017-02-15	87	2017-03-01	2017-03-31
70	2016-12-05	2017-03-12	87	2017-01-01	2017-01-31
70	2016-12-05	2017-03-12	87	2017-02-01	2017-02-28
70	2016-12-05	2017-03-12	87	2017-03-01	2017-03-31
71	2016-12-05	2017-01-13	87	2017-01-01	2017-01-31
71	2016-12-05	2017-01-13	87	2017-02-01	2017-02-28
71	2016-12-05	2017-01-13	87	2017-03-01	2017-03-31
72	2016-12-05	2017-01-29	87	2017-01-01	2017-01-31
72	2016-12-05	2017-01-29	87	2017-02-01	2017-02-28
72	2016-12-05	2017-01-29	87	2017-03-01	2017-03-31
73	2016-12-05	2017-01-20	87	2017-01-01	2017-01-31
73	2016-12-05	2017-01-20	87	2017-02-01	2017-02-28
73	2016-12-05	2017-01-20	87	2017-03-01	2017-03-31
74	2016-12-05	2017-01-09	87	2017-01-01	2017-01-31
74	2016-12-05	2017-01-09	87	2017-02-01	2017-02-28
74	2016-12-05	2017-01-09	87	2017-03-01	2017-03-31
75	2016-12-05	2017-02-25	87	2017-01-01	2017-01-31
75	2016-12-05	2017-02-25	87	2017-02-01	2017-02-28
75	2016-12-05	2017-02-25	87	2017-03-01	2017-03-31
76	2016-12-05	2017-01-28	87	2017-01-01	2017-01-31
76	2016-12-05	2017-01-28	87	2017-02-01	2017-02-28
76	2016-12-05	2017-01-28	87	2017-03-01	2017-03-31
77	2016-12-05	2017-02-09	87	2017-01-01	2017-01-31
77	2016-12-05	2017-02-09	87	2017-02-01	2017-02-28
77	2016-12-05	2017-02-09	87	2017-03-01	2017-03-31
78	2016-12-05	2017-01-23	87	2017-01-01	2017-01-31
78	2016-12-05	2017-01-23	87	2017-02-01	2017-02-28
78	2016-12-05	2017-01-23	87	2017-03-01	2017-03-31
79	2016-12-05	2017-01-27	87	2017-01-01	2017-01-31
79	2016-12-05	2017-01-27	87	2017-02-01	2017-02-28
79	2016-12-05	2017-01-27	87	2017-03-01	2017-03-31
80	2016-12-05	2017-01-11	87	2017-01-01	2017-01-31
80	2016-12-05	2017-01-11	87	2017-02-01	2017-02-28
80	2016-12-05	2017-01-11	87	2017-03-01	2017-03-31
81	2016-12-05		30	2017-01-01	2017-01-31
81	2016-12-05		30	2017-02-01	2017-02-28
81	2016-12-05		30	2017-03-01	2017-03-31
82	2016-12-05		30	2017-01-01	2017-01-31
82	2016-12-05		30	2017-02-01	2017-02-28
82	2016-12-05		30	2017-03-01	2017-03-31
83	2016-12-05		30	2017-01-01	2017-01-31
83	2016-12-05		30	2017-02-01	2017-02-28
83	2016-12-05		30	2017-03-01	2017-03-31
84	2016-12-05		30	2017-01-01	2017-01-31
84	2016-12-05		30	2017-02-01	2017-02-28
84	2016-12-05		30	2017-03-01	2017-03-31
85	2016-12-05		30	2017-01-01	2017-01-31
85	2016-12-05		30	2017-02-01	2017-02-28
85	2016-12-05		30	2017-03-01	2017-03-31
86	2016-12-05	2017-01-17	30	2017-01-01	2017-01-31
86	2016-12-05	2017-01-17	30	2017-02-01	2017-02-28
86	2016-12-05	2017-01-17	30	2017-03-01	2017-03-31
87	2016-12-05		30	2017-01-01	2017-01-31
87	2016-12-05		30	2017-02-01	2017-02-28
87	2016-12-05		30	2017-03-01	2017-03-31
88	2016-12-05	2017-03-26	30	2017-01-01	2017-01-31
88	2016-12-05	2017-03-26	30	2017-02-01	2017-02-28
88	2016-12-05	2017-03-26	30	2017-03-01	2017-03-31
89	2016-12-05		30	2017-01-01	2017-01-31
89	2016-12-05		30	2017-02-01	2017-02-28
89	2016-12-05		30	2017-03-01	2017-03-31
90	2016-12-06	2017-02-25	87	2017-01-01	2017-01-31
90	2016-12-06	2017-02-25	87	2017-02-01	2017-02-28
90	2016-12-06	2017-02-25	87	2017-03-01	2017-03-31
91	2016-12-06	2017-03-14	87	2017-01-01	2017-01-31
91	2016-12-06	2017-03-14	87	2017-02-01	2017-02-28
91	2016-12-06	2017-03-14	87	2017-03-01	2017-03-31
92	2016-12-06	2017-02-22	87	2017-01-01	2017-01-31
92	2016-12-06	2017-02-22	87	2017-02-01	2017-02-28
92	2016-12-06	2017-02-22	87	2017-03-01	2017-03-31
93	2016-12-06	2017-02-05	87	2017-01-01	2017-01-31
93	2016-12-06	2017-02-05	87	2017-02-01	2017-02-28
93	2016-12-06	2017-02-05	87	2017-03-01	2017-03-31
94	2016-12-06	2017-01-28	87	2017-01-01	2017-01-31
94	2016-12-06	2017-01-28	87	2017-02-01	2017-02-28
94	2016-12-06	2017-01-28	87	2017-03-01	2017-03-31
95	2016-12-06	2017-02-03	87	2017-01-01	2017-01-31
95	2016-12-06	2017-02-03	87	2017-02-01	2017-02-28
95	2016-12-06	2017-02-03	87	2017-03-01	2017-03-31
96	2016-12-06	2017-02-20	87	2017-01-01	2017-01-31
96	2016-12-06	2017-02-20	87	2017-02-01	2017-02-28
96	2016-12-06	2017-02-20	87	2017-03-01	2017-03-31
97	2016-12-06	2017-03-12	87	2017-01-01	2017-01-31
97	2016-12-06	2017-03-12	87	2017-02-01	2017-02-28
97	2016-12-06	2017-03-12	87	2017-03-01	2017-03-31
98	2016-12-06	2017-03-05	87	2017-01-01	2017-01-31
98	2016-12-06	2017-03-05	87	2017-02-01	2017-02-28
98	2016-12-06	2017-03-05	87	2017-03-01	2017-03-31
99	2016-12-06		30	2017-01-01	2017-01-31
99	2016-12-06		30	2017-02-01	2017-02-28
99	2016-12-06		30	2017-03-01	2017-03-31
100	2016-12-06	2017-03-11	30	2017-01-01	2017-01-31
100	2016-12-06	2017-03-11	30	2017-02-01	2017-02-28
100	2016-12-06	2017-03-11	30	2017-03-01	2017-03-31
101	2016-12-06	2017-01-30	30	2017-01-01	2017-01-31
101	2016-12-06	2017-01-30	30	2017-02-01	2017-02-28
101	2016-12-06	2017-01-30	30	2017-03-01	2017-03-31
102	2016-12-06	2017-01-25	30	2017-01-01	2017-01-31
102	2016-12-06	2017-01-25	30	2017-02-01	2017-02-28
102	2016-12-06	2017-01-25	30	2017-03-01	2017-03-31
103	2016-12-06		30	2017-01-01	2017-01-31
103	2016-12-06		30	2017-02-01	2017-02-28
103	2016-12-06		30	2017-03-01	2017-03-31
104	2016-12-06	2017-02-23	30	2017-01-01	2017-01-31
104	2016-12-06	2017-02-23	30	2017-02-01	2017-02-28
104	2016-12-06	2017-02-23	30	2017-03-01	2017-03-31
105	2016-12-06		30	2017-01-01	2017-01-31
105	2016-12-06		30	2017-02-01	2017-02-28
105	2016-12-06		30	2017-03-01	2017-03-31
106	2016-12-06	2017-03-30	30	2017-01-01	2017-01-31
106	2016-12-06	2017-03-30	30	2017-02-01	2017-02-28
106	2016-12-06	2017-03-30	30	2017-03-01	2017-03-31
107	2016-12-06		30	2017-01-01	2017-01-31
107	2016-12-06		30	2017-02-01	2017-02-28
107	2016-12-06		30	2017-03-01	2017-03-31
108	2016-12-06	2017-02-26	30	2017-01-01	2017-01-31
108	2016-12-06	2017-02-26	30	2017-02-01	2017-02-28
108	2016-12-06	2017-02-26	30	2017-03-01	2017-03-31
109	2016-12-06	2017-01-24	30	2017-01-01	2017-01-31
109	2016-12-06	2017-01-24	30	2017-02-01	2017-02-28
109	2016-12-06	2017-01-24	30	2017-03-01	2017-03-31
110	2016-12-07	2017-02-19	87	2017-01-01	2017-01-31
110	2016-12-07	2017-02-19	87	2017-02-01	2017-02-28
110	2016-12-07	2017-02-19	87	2017-03-01	2017-03-31
111	2016-12-07	2017-01-08	87	2017-01-01	2017-01-31
111	2016-12-07	2017-01-08	87	2017-02-01	2017-02-28
111	2016-12-07	2017-01-08	87	2017-03-01	2017-03-31
112	2016-12-07	2017-01-28	87	2017-01-01	2017-01-31
112	2016-12-07	2017-01-28	87	2017-02-01	2017-02-28
112	2016-12-07	2017-01-28	87	2017-03-01	2017-03-31
113	2016-12-07	2017-03-17	87	2017-01-01	2017-01-31
113	2016-12-07	2017-03-17	87	2017-02-01	2017-02-28
113	2016-12-07	2017-03-17	87	2017-03-01	2017-03-31
114	2016-12-07	2017-02-26	87	2017-01-01	2017-01-31
114	2016-12-07	2017-02-26	87	2017-02-01	2017-02-28
114	2016-12-07	2017-02-26	87	2017-03-01	2017-03-31
115	2016-12-07	2017-02-27	87	2017-01-01	2017-01-31
115	2016-12-07	2017-02-27	87	2017-02-01	2017-02-28
115	2016-12-07	2017-02-27	87	2017-03-01	2017-03-31
116	2016-12-07	2017-02-25	87	2017-01-01	2017-01-31
116	2016-12-07	2017-02-25	87	2017-02-01	2017-02-28
116	2016-12-07	2017-02-25	87	2017-03-01	2017-03-31
117	2016-12-07	2017-02-01	87	2017-01-01	2017-01-31
117	2016-12-07	2017-02-01	87	2017-02-01	2017-02-28
117	2016-12-07	2017-02-01	87	2017-03-01	2017-03-31
118	2016-12-07	2017-03-03	87	2017-01-01	2017-01-31
118	2016-12-07	2017-03-03	87	2017-02-01	2017-02-28
118	2016-12-07	2017-03-03	87	2017-03-01	2017-03-31
119	2016-12-07	2017-01-17	87	2017-01-01	2017-01-31
119	2016-12-07	2017-01-17	87	2017-02-01	2017-02-28
119	2016-12-07	2017-01-17	87	2017-03-01	2017-03-31
120	2016-12-07	2017-02-26	30	2017-01-01	2017-01-31
120	2016-12-07	2017-02-26	30	2017-02-01	2017-02-28
120	2016-12-07	2017-02-26	30	2017-03-01	2017-03-31
121	2016-12-07	2017-02-11	30	2017-01-01	2017-01-31
121	2016-12-07	2017-02-11	30	2017-02-01	2017-02-28
121	2016-12-07	2017-02-11	30	2017-03-01	2017-03-31
122	2016-12-07		30	2017-01-01	2017-01-31
122	2016-12-07		30	2017-02-01	2017-02-28
122	2016-12-07		30	2017-03-01	2017-03-31
123	2016-12-07		30	2017-01-01	2017-01-31
123	2016-12-07		30	2017-02-01	2017-02-28
123	2016-12-07		30	2017-03-01	2017-03-31
124	2016-12-07		30	2017-01-01	2017-01-31
124	2016-12-07		30	2017-02-01	2017-02-28
124	2016-12-07		30	2017-03-01	2017-03-31
125	2016-12-07		30	2017-01-01	2017-01-31
125	2016-12-07		30	2017-02-01	2017-02-28
125	2016-12-07		30	2017-03-01	2017-03-31
126	2016-12-07		30	2017-01-01	2017-01-31
126	2016-12-07		30	2017-02-01	2017-02-28
126	2016-12-07		30	2017-03-01	2017-03-31
127	2016-12-07		30	2017-01-01	2017-01-31
127	2016-12-07		30	2017-02-01	2017-02-28
127	2016-12-07		30	2017-03-01	2017-03-31
128	2016-12-07	2017-02-04	30	2017-01-01	2017-01-31
128	2016-12-07	2017-02-04	30	2017-02-01	2017-02-28
128	2016-12-07	2017-02-04	30	2017-03-01	2017-03-31
129	2016-12-07		30	2017-01-01	2017-01-31
129	2016-12-07		30	2017-02-01	2017-02-28
129	2016-12-07		30	2017-03-01	2017-03-31
130	2016-12-07		30	2017-01-01	2017-01-31
130	2016-12-07		30	2017-02-01	2017-02-28
130	2016-12-07		30	2017-03-01	2017-03-31
131	2016-12-08	2017-02-15	87	2017-01-01	2017-01-31
131	2016-12-08	2017-02-15	87	2017-02-01	2017-02-28
131	2016-12-08	2017-02-15	87	2017-03-01	2017-03-31
132	2016-12-08	2017-01-10	87	2017-01-01	2017-01-31
132	2016-12-08	2017-01-10	87	2017-02-01	2017-02-28
132	2016-12-08	2017-01-10	87	2017-03-01	2017-03-31
133	2016-12-08	2017-03-04	87	2017-01-01	2017-01-31
133	2016-12-08	2017-03-04	87	2017-02-01	2017-02-28
133	2016-12-08	2017-03-04	87	2017-03-01	2017-03-31
134	2016-12-08	2017-02-21	87	2017-01-01	2017-01-31
134	2016-12-08	2017-02-21	87	2017-02-01	2017-02-28
134	2016-12-08	2017-02-21	87	2017-03-01	2017-03-31
135	2016-12-08	2017-03-17	87	2017-01-01	2017-01-31
135	2016-12-08	2017-03-17	87	2017-02-01	2017-02-28
135	2016-12-08	2017-03-17	87	2017-03-01	2017-03-31
136	2016-12-08	2017-03-17	87	2017-01-01	2017-01-31
136	2016-12-08	2017-03-17	87	2017-02-01	2017-02-28
136	2016-12-08	2017-03-17	87	2017-03-01	2017-03-31
137	2016-12-08	2017-03-16	87	2017-01-01	2017-01-31
137	2016-12-08	2017-03-16	87	2017-02-01	2017-02-28
137	2016-12-08	2017-03-16	87	2017-03-01	2017-03-31
138	2016-12-08	2017-01-29	87	2017-01-01	2017-01-31
138	2016-12-08	2017-01-29	87	2017-02-01	2017-02-28
138	2016-12-08	2017-01-29	87	2017-03-01	2017-03-31
139	2016-12-08	2017-03-13	30	2017-01-01	2017-01-31
139	2016-12-08	2017-03-13	30	2017-02-01	2017-02-28
139	2016-12-08	2017-03-13	30	2017-03-01	2017-03-31
140	2016-12-08	2017-01-23	30	2017-01-01	2017-01-31
140	2016-12-08	2017-01-23	30	2017-02-01	2017-02-28
140	2016-12-08	2017-01-23	30	2017-03-01	2017-03-31
141	2016-12-08		30	2017-01-01	2017-01-31
141	2016-12-08		30	2017-02-01	2017-02-28
141	2016-12-08		30	2017-03-01	2017-03-31
142	2016-12-08	2017-03-24	30	2017-01-01	2017-01-31
142	2016-12-08	2017-03-24	30	2017-02-01	2017-02-28
142	2016-12-08	2017-03-24	30	2017-03-01	2017-03-31
143	2016-12-08	2017-03-06	30	2017-01-01	2017-01-31
143	2016-12-08	2017-03-06	30	2017-02-01	2017-02-28
143	2016-12-08	2017-03-06	30	2017-03-01	2017-03-31
144	2016-12-08		30	2017-01-01	2017-01-31
144	2016-12-08		30	2017-02-01	2017-02-28
144	2016-12-08		30	2017-03-01	2017-03-31
145	2016-12-08	2017-03-01	30	2017-01-01	2017-01-31
145	2016-12-08	2017-03-01	30	2017-02-01	2017-02-28
145	2016-12-08	2017-03-01	30	2017-03-01	2017-03-31
146	2016-12-08	2017-02-16	30	2017-01-01	2017-01-31
146	2016-12-08	2017-02-16	30	2017-02-01	2017-02-28
146	2016-12-08	2017-02-16	30	2017-03-01	2017-03-31
147	2016-12-09	2017-03-05	87	2017-01-01	2017-01-31
147	2016-12-09	2017-03-05	87	2017-02-01	2017-02-28
147	2016-12-09	2017-03-05	87	2017-03-01	2017-03-31
148	2016-12-09	2017-03-08	87	2017-01-01	2017-01-31
148	2016-12-09	2017-03-08	87	2017-02-01	2017-02-28
148	2016-12-09	2017-03-08	87	2017-03-01	2017-03-31
149	2016-12-09	2017-01-09	87	2017-01-01	2017-01-31
149	2016-12-09	2017-01-09	87	2017-02-01	2017-02-28
149	2016-12-09	2017-01-09	87	2017-03-01	2017-03-31
150	2016-12-09	2017-03-19	87	2017-01-01	2017-01-31
150	2016-12-09	2017-03-19	87	2017-02-01	2017-02-28
150	2016-12-09	2017-03-19	87	2017-03-01	2017-03-31
151	2016-12-09	2017-03-03	87	2017-01-01	2017-01-31
151	2016-12-09	2017-03-03	87	2017-02-01	2017-02-28
151	2016-12-09	2017-03-03	87	2017-03-01	2017-03-31
152	2016-12-09	2017-01-21	87	2017-01-01	2017-01-31
152	2016-12-09	2017-01-21	87	2017-02-01	2017-02-28
152	2016-12-09	2017-01-21	87	2017-03-01	2017-03-31
153	2016-12-09		30	2017-01-01	2017-01-31
153	2016-12-09		30	2017-02-01	2017-02-28
153	2016-12-09		30	2017-03-01	2017-03-31
154	2016-12-09		30	2017-01-01	2017-01-31
154	2016-12-09		30	2017-02-01	2017-02-28
154	2016-12-09		30	2017-03-01	2017-03-31
155	2016-12-09	2017-02-04	30	2017-01-01	2017-01-31
155	2016-12-09	2017-02-04	30	2017-02-01	2017-02-28
155	2016-12-09	2017-02-04	30	2017-03-01	2017-03-31
156	2016-12-09		30	2017-01-01	2017-01-31
156	2016-12-09		30	2017-02-01	2017-02-28
156	2016-12-09		30	2017-03-01	2017-03-31
157	2016-12-09	2017-02-25	30	2017-01-01	2017-01-31
157	2016-12-09	2017-02-25	30	2017-02-01	2017-02-28
157	2016-12-09	2017-02-25	30	2017-03-01	2017-03-31
158	2016-12-09		30	2017-01-01	2017-01-31
158	2016-12-09		30	2017-02-01	2017-02-28
158	2016-12-09		30	2017-03-01	2017-03-31
159	2016-12-09		30	2017-01-01	2017-01-31
159	2016-12-09		30	2017-02-01	2017-02-28
159	2016-12-09		30	2017-03-01	2017-03-31
160	2016-12-09	2017-03-27	30	2017-01-01	2017-01-31
160	2016-12-09	2017-03-27	30	2017-02-01	2017-02-28
160	2016-12-09	2017-03-27	30	2017-03-01	2017-03-31
161	2016-12-09		30	2017-01-01	2017-01-31
161	2016-12-09		30	2017-02-01	2017-02-28
161	2016-12-09		30	2017-03-01	2017-03-31
162	2016-12-09		30	2017-01-01	2017-01-31
162	2016-12-09		30	2017-02-01	2017-02-28
162	2016-12-09		30	2017-03-01	2017-03-31
163	2016-12-09		30	2017-01-01	2017-01-31
163	2016-12-09		30	2017-02-01	2017-02-28
163	2016-12-09		30	2017-03-01	2017-03-31
164	2016-12-09		30	2017-01-01	2017-01-31
164	2016-12-09		30	2017-02-01	2017-02-28
164	2016-12-09		30	2017-03-01	2017-03-31
165	2016-12-09		30	2017-01-01	2017-01-31
165	2016-12-09		30	2017-02-01	2017-02-28
165	2016-12-09		30	2017-03-01	2017-03-31
166	2016-12-09		30	2017-01-01	2017-01-31
166	2016-12-09		30	2017-02-01	2017-02-28
166	2016-12-09		30	2017-03-01	2017-03-31
167	2016-12-09	2017-01-19	30	2017-01-01	2017-01-31
167	2016-12-09	2017-01-19	30	2017-02-01	2017-02-28

#5 Create Temporary Table called Status with Active Status for both Segments
WITH months as
(SELECT
  '2017-01-01' as first_day,
  '2017-01-31' as last_day
UNION
SELECT
  '2017-02-01' as first_day,
  '2017-02-28' as last_day
UNION
SELECT
  '2017-03-01' as first_day,
  '2017-03-31' as last_day
),
cross_join AS
(SELECT *
FROM subscriptions
CROSS JOIN months),
status AS(
SELECT id, first_day AS 'Month',
CASE WHEN (segment = 87 AND first_day > subscription_start) THEN 1 ELSE 0 END AS 'is_active_87',  
CASE WHEN (segment = 30 AND first_day > subscription_start) THEN 1 ELSE 0 END AS 'is_active_30',
FROM cross_join
)
SELECT *
FROM status
LIMIT 500;

id	Month	is_active_87	is_active_30
1	2017-01-01	1	0
1	2017-02-01	1	0
1	2017-03-01	1	0
2	2017-01-01	1	0
2	2017-02-01	1	0
2	2017-03-01	1	0
3	2017-01-01	1	0
3	2017-02-01	1	0
3	2017-03-01	1	0
4	2017-01-01	1	0
4	2017-02-01	1	0
4	2017-03-01	1	0
5	2017-01-01	1	0
5	2017-02-01	1	0
5	2017-03-01	1	0
6	2017-01-01	1	0
6	2017-02-01	1	0
6	2017-03-01	1	0
7	2017-01-01	1	0
7	2017-02-01	1	0
7	2017-03-01	1	0
8	2017-01-01	1	0
8	2017-02-01	1	0
8	2017-03-01	1	0
9	2017-01-01	1	0
9	2017-02-01	1	0
9	2017-03-01	1	0
10	2017-01-01	1	0
10	2017-02-01	1	0
10	2017-03-01	1	0
11	2017-01-01	1	0
11	2017-02-01	1	0
11	2017-03-01	1	0
12	2017-01-01	1	0
12	2017-02-01	1	0
12	2017-03-01	1	0
13	2017-01-01	0	1
13	2017-02-01	0	1
13	2017-03-01	0	1
14	2017-01-01	0	1
14	2017-02-01	0	1
14	2017-03-01	0	1
15	2017-01-01	0	1
15	2017-02-01	0	1
15	2017-03-01	0	1
16	2017-01-01	0	1
16	2017-02-01	0	1
16	2017-03-01	0	1
17	2017-01-01	0	1
17	2017-02-01	0	1
17	2017-03-01	0	1
18	2017-01-01	1	0
18	2017-02-01	1	0
18	2017-03-01	1	0
19	2017-01-01	1	0
19	2017-02-01	1	0
19	2017-03-01	1	0
20	2017-01-01	1	0
20	2017-02-01	1	0
20	2017-03-01	1	0
21	2017-01-01	1	0
21	2017-02-01	1	0
21	2017-03-01	1	0
22	2017-01-01	1	0
22	2017-02-01	1	0
22	2017-03-01	1	0
23	2017-01-01	1	0
23	2017-02-01	1	0
23	2017-03-01	1	0
24	2017-01-01	1	0
24	2017-02-01	1	0
24	2017-03-01	1	0
25	2017-01-01	1	0
25	2017-02-01	1	0
25	2017-03-01	1	0
26	2017-01-01	1	0
26	2017-02-01	1	0
26	2017-03-01	1	0
27	2017-01-01	1	0
27	2017-02-01	1	0
27	2017-03-01	1	0
28	2017-01-01	0	1
28	2017-02-01	0	1
28	2017-03-01	0	1
29	2017-01-01	0	1
29	2017-02-01	0	1
29	2017-03-01	0	1
30	2017-01-01	0	1
30	2017-02-01	0	1
30	2017-03-01	0	1
31	2017-01-01	0	1
31	2017-02-01	0	1
31	2017-03-01	0	1
32	2017-01-01	0	1
32	2017-02-01	0	1
32	2017-03-01	0	1
33	2017-01-01	0	1
33	2017-02-01	0	1
33	2017-03-01	0	1
34	2017-01-01	0	1
34	2017-02-01	0	1
34	2017-03-01	0	1
35	2017-01-01	1	0
35	2017-02-01	1	0
35	2017-03-01	1	0
36	2017-01-01	1	0
36	2017-02-01	1	0
36	2017-03-01	1	0
37	2017-01-01	1	0
37	2017-02-01	1	0
37	2017-03-01	1	0
38	2017-01-01	1	0
38	2017-02-01	1	0
38	2017-03-01	1	0
39	2017-01-01	0	1
39	2017-02-01	0	1
39	2017-03-01	0	1
40	2017-01-01	0	1
40	2017-02-01	0	1
40	2017-03-01	0	1
41	2017-01-01	0	1
41	2017-02-01	0	1
41	2017-03-01	0	1
42	2017-01-01	0	1
42	2017-02-01	0	1
42	2017-03-01	0	1
43	2017-01-01	0	1
43	2017-02-01	0	1
43	2017-03-01	0	1
44	2017-01-01	1	0
44	2017-02-01	1	0
44	2017-03-01	1	0
45	2017-01-01	1	0
45	2017-02-01	1	0
45	2017-03-01	1	0
46	2017-01-01	1	0
46	2017-02-01	1	0
46	2017-03-01	1	0
47	2017-01-01	1	0
47	2017-02-01	1	0
47	2017-03-01	1	0
48	2017-01-01	1	0
48	2017-02-01	1	0
48	2017-03-01	1	0
49	2017-01-01	1	0
49	2017-02-01	1	0
49	2017-03-01	1	0
50	2017-01-01	1	0
50	2017-02-01	1	0
50	2017-03-01	1	0
51	2017-01-01	1	0
51	2017-02-01	1	0
51	2017-03-01	1	0
52	2017-01-01	1	0
52	2017-02-01	1	0
52	2017-03-01	1	0
53	2017-01-01	1	0
53	2017-02-01	1	0
53	2017-03-01	1	0
54	2017-01-01	1	0
54	2017-02-01	1	0
54	2017-03-01	1	0
55	2017-01-01	1	0
55	2017-02-01	1	0
55	2017-03-01	1	0
56	2017-01-01	0	1
56	2017-02-01	0	1
56	2017-03-01	0	1
57	2017-01-01	0	1
57	2017-02-01	0	1
57	2017-03-01	0	1
58	2017-01-01	0	1
58	2017-02-01	0	1
58	2017-03-01	0	1
59	2017-01-01	0	1
59	2017-02-01	0	1
59	2017-03-01	0	1
60	2017-01-01	0	1
60	2017-02-01	0	1
60	2017-03-01	0	1
61	2017-01-01	0	1
61	2017-02-01	0	1
61	2017-03-01	0	1
62	2017-01-01	0	1
62	2017-02-01	0	1
62	2017-03-01	0	1
63	2017-01-01	0	1
63	2017-02-01	0	1
63	2017-03-01	0	1
64	2017-01-01	0	1
64	2017-02-01	0	1
64	2017-03-01	0	1
65	2017-01-01	0	1
65	2017-02-01	0	1
65	2017-03-01	0	1
66	2017-01-01	0	1
66	2017-02-01	0	1
66	2017-03-01	0	1
67	2017-01-01	0	1
67	2017-02-01	0	1
67	2017-03-01	0	1
68	2017-01-01	1	0
68	2017-02-01	1	0
68	2017-03-01	1	0
69	2017-01-01	1	0
69	2017-02-01	1	0
69	2017-03-01	1	0
70	2017-01-01	1	0
70	2017-02-01	1	0
70	2017-03-01	1	0
71	2017-01-01	1	0
71	2017-02-01	1	0
71	2017-03-01	1	0
72	2017-01-01	1	0
72	2017-02-01	1	0
72	2017-03-01	1	0
73	2017-01-01	1	0
73	2017-02-01	1	0
73	2017-03-01	1	0
74	2017-01-01	1	0
74	2017-02-01	1	0
74	2017-03-01	1	0
75	2017-01-01	1	0
75	2017-02-01	1	0
75	2017-03-01	1	0
76	2017-01-01	1	0
76	2017-02-01	1	0
76	2017-03-01	1	0
77	2017-01-01	1	0
77	2017-02-01	1	0
77	2017-03-01	1	0
78	2017-01-01	1	0
78	2017-02-01	1	0
78	2017-03-01	1	0
79	2017-01-01	1	0
79	2017-02-01	1	0
79	2017-03-01	1	0
80	2017-01-01	1	0
80	2017-02-01	1	0
80	2017-03-01	1	0
81	2017-01-01	0	1
81	2017-02-01	0	1
81	2017-03-01	0	1
82	2017-01-01	0	1
82	2017-02-01	0	1
82	2017-03-01	0	1
83	2017-01-01	0	1
83	2017-02-01	0	1
83	2017-03-01	0	1
84	2017-01-01	0	1
84	2017-02-01	0	1
84	2017-03-01	0	1
85	2017-01-01	0	1
85	2017-02-01	0	1
85	2017-03-01	0	1
86	2017-01-01	0	1
86	2017-02-01	0	1
86	2017-03-01	0	1
87	2017-01-01	0	1
87	2017-02-01	0	1
87	2017-03-01	0	1
88	2017-01-01	0	1
88	2017-02-01	0	1
88	2017-03-01	0	1
89	2017-01-01	0	1
89	2017-02-01	0	1
89	2017-03-01	0	1
90	2017-01-01	1	0
90	2017-02-01	1	0
90	2017-03-01	1	0
91	2017-01-01	1	0
91	2017-02-01	1	0
91	2017-03-01	1	0
92	2017-01-01	1	0
92	2017-02-01	1	0
92	2017-03-01	1	0
93	2017-01-01	1	0
93	2017-02-01	1	0
93	2017-03-01	1	0
94	2017-01-01	1	0
94	2017-02-01	1	0
94	2017-03-01	1	0
95	2017-01-01	1	0
95	2017-02-01	1	0
95	2017-03-01	1	0
96	2017-01-01	1	0
96	2017-02-01	1	0
96	2017-03-01	1	0
97	2017-01-01	1	0
97	2017-02-01	1	0
97	2017-03-01	1	0
98	2017-01-01	1	0
98	2017-02-01	1	0
98	2017-03-01	1	0
99	2017-01-01	0	1
99	2017-02-01	0	1
99	2017-03-01	0	1
100	2017-01-01	0	1
100	2017-02-01	0	1
100	2017-03-01	0	1
101	2017-01-01	0	1
101	2017-02-01	0	1
101	2017-03-01	0	1
102	2017-01-01	0	1
102	2017-02-01	0	1
102	2017-03-01	0	1
103	2017-01-01	0	1
103	2017-02-01	0	1
103	2017-03-01	0	1
104	2017-01-01	0	1
104	2017-02-01	0	1
104	2017-03-01	0	1
105	2017-01-01	0	1
105	2017-02-01	0	1
105	2017-03-01	0	1
106	2017-01-01	0	1
106	2017-02-01	0	1
106	2017-03-01	0	1
107	2017-01-01	0	1
107	2017-02-01	0	1
107	2017-03-01	0	1
108	2017-01-01	0	1
108	2017-02-01	0	1
108	2017-03-01	0	1
109	2017-01-01	0	1
109	2017-02-01	0	1
109	2017-03-01	0	1
110	2017-01-01	1	0
110	2017-02-01	1	0
110	2017-03-01	1	0
111	2017-01-01	1	0
111	2017-02-01	1	0
111	2017-03-01	1	0
112	2017-01-01	1	0
112	2017-02-01	1	0
112	2017-03-01	1	0
113	2017-01-01	1	0
113	2017-02-01	1	0
113	2017-03-01	1	0
114	2017-01-01	1	0
114	2017-02-01	1	0
114	2017-03-01	1	0
115	2017-01-01	1	0
115	2017-02-01	1	0
115	2017-03-01	1	0
116	2017-01-01	1	0
116	2017-02-01	1	0
116	2017-03-01	1	0
117	2017-01-01	1	0
117	2017-02-01	1	0
117	2017-03-01	1	0
118	2017-01-01	1	0
118	2017-02-01	1	0
118	2017-03-01	1	0
119	2017-01-01	1	0
119	2017-02-01	1	0
119	2017-03-01	1	0
120	2017-01-01	0	1
120	2017-02-01	0	1
120	2017-03-01	0	1
121	2017-01-01	0	1
121	2017-02-01	0	1
121	2017-03-01	0	1
122	2017-01-01	0	1
122	2017-02-01	0	1
122	2017-03-01	0	1
123	2017-01-01	0	1
123	2017-02-01	0	1
123	2017-03-01	0	1
124	2017-01-01	0	1
124	2017-02-01	0	1
124	2017-03-01	0	1
125	2017-01-01	0	1
125	2017-02-01	0	1
125	2017-03-01	0	1
126	2017-01-01	0	1
126	2017-02-01	0	1
126	2017-03-01	0	1
127	2017-01-01	0	1
127	2017-02-01	0	1
127	2017-03-01	0	1
128	2017-01-01	0	1
128	2017-02-01	0	1
128	2017-03-01	0	1
129	2017-01-01	0	1
129	2017-02-01	0	1
129	2017-03-01	0	1
130	2017-01-01	0	1
130	2017-02-01	0	1
130	2017-03-01	0	1
131	2017-01-01	1	0
131	2017-02-01	1	0
131	2017-03-01	1	0
132	2017-01-01	1	0
132	2017-02-01	1	0
132	2017-03-01	1	0
133	2017-01-01	1	0
133	2017-02-01	1	0
133	2017-03-01	1	0
134	2017-01-01	1	0
134	2017-02-01	1	0
134	2017-03-01	1	0
135	2017-01-01	1	0
135	2017-02-01	1	0
135	2017-03-01	1	0
136	2017-01-01	1	0
136	2017-02-01	1	0
136	2017-03-01	1	0
137	2017-01-01	1	0
137	2017-02-01	1	0
137	2017-03-01	1	0
138	2017-01-01	1	0
138	2017-02-01	1	0
138	2017-03-01	1	0
139	2017-01-01	0	1
139	2017-02-01	0	1
139	2017-03-01	0	1
140	2017-01-01	0	1
140	2017-02-01	0	1
140	2017-03-01	0	1
141	2017-01-01	0	1
141	2017-02-01	0	1
141	2017-03-01	0	1
142	2017-01-01	0	1
142	2017-02-01	0	1
142	2017-03-01	0	1
143	2017-01-01	0	1
143	2017-02-01	0	1
143	2017-03-01	0	1
144	2017-01-01	0	1
144	2017-02-01	0	1
144	2017-03-01	0	1
145	2017-01-01	0	1
145	2017-02-01	0	1
145	2017-03-01	0	1
146	2017-01-01	0	1
146	2017-02-01	0	1
146	2017-03-01	0	1
147	2017-01-01	1	0
147	2017-02-01	1	0
147	2017-03-01	1	0
148	2017-01-01	1	0
148	2017-02-01	1	0
148	2017-03-01	1	0
149	2017-01-01	1	0
149	2017-02-01	1	0
149	2017-03-01	1	0
150	2017-01-01	1	0
150	2017-02-01	1	0
150	2017-03-01	1	0
151	2017-01-01	1	0
151	2017-02-01	1	0
151	2017-03-01	1	0
152	2017-01-01	1	0
152	2017-02-01	1	0
152	2017-03-01	1	0
153	2017-01-01	0	1
153	2017-02-01	0	1
153	2017-03-01	0	1
154	2017-01-01	0	1
154	2017-02-01	0	1
154	2017-03-01	0	1
155	2017-01-01	0	1
155	2017-02-01	0	1
155	2017-03-01	0	1
156	2017-01-01	0	1
156	2017-02-01	0	1
156	2017-03-01	0	1
157	2017-01-01	0	1
157	2017-02-01	0	1
157	2017-03-01	0	1
158	2017-01-01	0	1
158	2017-02-01	0	1
158	2017-03-01	0	1
159	2017-01-01	0	1
159	2017-02-01	0	1
159	2017-03-01	0	1
160	2017-01-01	0	1
160	2017-02-01	0	1
160	2017-03-01	0	1
161	2017-01-01	0	1
161	2017-02-01	0	1
161	2017-03-01	0	1
162	2017-01-01	0	1
162	2017-02-01	0	1
162	2017-03-01	0	1
163	2017-01-01	0	1
163	2017-02-01	0	1
163	2017-03-01	0	1
164	2017-01-01	0	1
164	2017-02-01	0	1
164	2017-03-01	0	1
165	2017-01-01	0	1
165	2017-02-01	0	1
165	2017-03-01	0	1
166	2017-01-01	0	1
166	2017-02-01	0	1
166	2017-03-01	0	1
167	2017-01-01	0	1
167	2017-02-01	0	1
167	2017-03-01	0	1

With Canceled added
WITH months as
(SELECT
  '2017-01-01' as first_day,
  '2017-01-31' as last_day
UNION
SELECT
  '2017-02-01' as first_day,
  '2017-02-28' as last_day
UNION
SELECT
  '2017-03-01' as first_day,
  '2017-03-31' as last_day
),
cross_join AS
(SELECT *
FROM subscriptions
CROSS JOIN months),
status AS(
SELECT id, first_day AS 'Month',
CASE WHEN (segment = 87 AND first_day > subscription_start) THEN 1 ELSE 0 END AS 'is_active_87',  
CASE WHEN (segment = 30 AND first_day > subscription_start) THEN 1 ELSE 0 END AS 'is_active_30',
  CASE WHEN (segment = 87 AND last_day > subscription_end) THEN 1 ELSE 0 END AS 'is_canceled_87',
CASE WHEN (segment = 30 AND last_day > subscription_end) THEN 1 ELSE 0 END AS 'is_canceled_30'
FROM cross_join
)
SELECT *
FROM status
LIMIT 500;

id	Month	is_active_87	is_active_30	is_canceled_87	is_canceled_30
1	2017-01-01	1	0	0	0
1	2017-02-01	1	0	1	0
1	2017-03-01	1	0	1	0
2	2017-01-01	1	0	1	0
2	2017-02-01	1	0	1	0
2	2017-03-01	1	0	1	0
3	2017-01-01	1	0	0	0
3	2017-02-01	1	0	0	0
3	2017-03-01	1	0	1	0
4	2017-01-01	1	0	0	0
4	2017-02-01	1	0	1	0
4	2017-03-01	1	0	1	0
5	2017-01-01	1	0	0	0
5	2017-02-01	1	0	0	0
5	2017-03-01	1	0	1	0
6	2017-01-01	1	0	1	0
6	2017-02-01	1	0	1	0
6	2017-03-01	1	0	1	0
7	2017-01-01	1	0	0	0
7	2017-02-01	1	0	1	0
7	2017-03-01	1	0	1	0
8	2017-01-01	1	0	0	0
8	2017-02-01	1	0	0	0
8	2017-03-01	1	0	1	0
9	2017-01-01	1	0	0	0
9	2017-02-01	1	0	1	0
9	2017-03-01	1	0	1	0
10	2017-01-01	1	0	1	0
10	2017-02-01	1	0	1	0
10	2017-03-01	1	0	1	0
11	2017-01-01	1	0	1	0
11	2017-02-01	1	0	1	0
11	2017-03-01	1	0	1	0
12	2017-01-01	1	0	0	0
12	2017-02-01	1	0	1	0
12	2017-03-01	1	0	1	0
13	2017-01-01	0	1	0	0
13	2017-02-01	0	1	0	0
13	2017-03-01	0	1	0	0
14	2017-01-01	0	1	0	0
14	2017-02-01	0	1	0	0
14	2017-03-01	0	1	0	1
15	2017-01-01	0	1	0	0
15	2017-02-01	0	1	0	1
15	2017-03-01	0	1	0	1
16	2017-01-01	0	1	0	0
16	2017-02-01	0	1	0	0
16	2017-03-01	0	1	0	0
17	2017-01-01	0	1	0	0
17	2017-02-01	0	1	0	0
17	2017-03-01	0	1	0	0
18	2017-01-01	1	0	1	0
18	2017-02-01	1	0	1	0
18	2017-03-01	1	0	1	0
19	2017-01-01	1	0	1	0
19	2017-02-01	1	0	1	0
19	2017-03-01	1	0	1	0
20	2017-01-01	1	0	1	0
20	2017-02-01	1	0	1	0
20	2017-03-01	1	0	1	0
21	2017-01-01	1	0	1	0
21	2017-02-01	1	0	1	0
21	2017-03-01	1	0	1	0
22	2017-01-01	1	0	1	0
22	2017-02-01	1	0	1	0
22	2017-03-01	1	0	1	0
23	2017-01-01	1	0	1	0
23	2017-02-01	1	0	1	0
23	2017-03-01	1	0	1	0
24	2017-01-01	1	0	1	0
24	2017-02-01	1	0	1	0
24	2017-03-01	1	0	1	0
25	2017-01-01	1	0	0	0
25	2017-02-01	1	0	1	0
25	2017-03-01	1	0	1	0
26	2017-01-01	1	0	1	0
26	2017-02-01	1	0	1	0
26	2017-03-01	1	0	1	0
27	2017-01-01	1	0	1	0
27	2017-02-01	1	0	1	0
27	2017-03-01	1	0	1	0
28	2017-01-01	0	1	0	0
28	2017-02-01	0	1	0	0
28	2017-03-01	0	1	0	1
29	2017-01-01	0	1	0	0
29	2017-02-01	0	1	0	1
29	2017-03-01	0	1	0	1
30	2017-01-01	0	1	0	1
30	2017-02-01	0	1	0	1
30	2017-03-01	0	1	0	1
31	2017-01-01	0	1	0	0
31	2017-02-01	0	1	0	0
31	2017-03-01	0	1	0	0
32	2017-01-01	0	1	0	1
32	2017-02-01	0	1	0	1
32	2017-03-01	0	1	0	1
33	2017-01-01	0	1	0	0
33	2017-02-01	0	1	0	0
33	2017-03-01	0	1	0	0
34	2017-01-01	0	1	0	0
34	2017-02-01	0	1	0	1
34	2017-03-01	0	1	0	1
35	2017-01-01	1	0	0	0
35	2017-02-01	1	0	1	0
35	2017-03-01	1	0	1	0
36	2017-01-01	1	0	0	0
36	2017-02-01	1	0	0	0
36	2017-03-01	1	0	1	0
37	2017-01-01	1	0	0	0
37	2017-02-01	1	0	0	0
37	2017-03-01	1	0	1	0
38	2017-01-01	1	0	0	0
38	2017-02-01	1	0	0	0
38	2017-03-01	1	0	1	0
39	2017-01-01	0	1	0	0
39	2017-02-01	0	1	0	0
39	2017-03-01	0	1	0	0
40	2017-01-01	0	1	0	0
40	2017-02-01	0	1	0	0
40	2017-03-01	0	1	0	0
41	2017-01-01	0	1	0	0
41	2017-02-01	0	1	0	0
41	2017-03-01	0	1	0	0
42	2017-01-01	0	1	0	0
42	2017-02-01	0	1	0	0
42	2017-03-01	0	1	0	1
43	2017-01-01	0	1	0	0
43	2017-02-01	0	1	0	0
43	2017-03-01	0	1	0	0
44	2017-01-01	1	0	0	0
44	2017-02-01	1	0	0	0
44	2017-03-01	1	0	1	0
45	2017-01-01	1	0	0	0
45	2017-02-01	1	0	1	0
45	2017-03-01	1	0	1	0
46	2017-01-01	1	0	0	0
46	2017-02-01	1	0	1	0
46	2017-03-01	1	0	1	0
47	2017-01-01	1	0	0	0
47	2017-02-01	1	0	1	0
47	2017-03-01	1	0	1	0
48	2017-01-01	1	0	0	0
48	2017-02-01	1	0	0	0
48	2017-03-01	1	0	1	0
49	2017-01-01	1	0	0	0
49	2017-02-01	1	0	0	0
49	2017-03-01	1	0	1	0
50	2017-01-01	1	0	0	0
50	2017-02-01	1	0	1	0
50	2017-03-01	1	0	1	0
51	2017-01-01	1	0	1	0
51	2017-02-01	1	0	1	0
51	2017-03-01	1	0	1	0
52	2017-01-01	1	0	0	0
52	2017-02-01	1	0	1	0
52	2017-03-01	1	0	1	0
53	2017-01-01	1	0	0	0
53	2017-02-01	1	0	1	0
53	2017-03-01	1	0	1	0
54	2017-01-01	1	0	0	0
54	2017-02-01	1	0	0	0
54	2017-03-01	1	0	1	0
55	2017-01-01	1	0	0	0
55	2017-02-01	1	0	1	0
55	2017-03-01	1	0	1	0
56	2017-01-01	0	1	0	0
56	2017-02-01	0	1	0	0
56	2017-03-01	0	1	0	0
57	2017-01-01	0	1	0	0
57	2017-02-01	0	1	0	0
57	2017-03-01	0	1	0	0
58	2017-01-01	0	1	0	0
58	2017-02-01	0	1	0	0
58	2017-03-01	0	1	0	0
59	2017-01-01	0	1	0	0
59	2017-02-01	0	1	0	0
59	2017-03-01	0	1	0	0
60	2017-01-01	0	1	0	0
60	2017-02-01	0	1	0	0
60	2017-03-01	0	1	0	0
61	2017-01-01	0	1	0	0
61	2017-02-01	0	1	0	0
61	2017-03-01	0	1	0	0
62	2017-01-01	0	1	0	0
62	2017-02-01	0	1	0	0
62	2017-03-01	0	1	0	1
63	2017-01-01	0	1	0	1
63	2017-02-01	0	1	0	1
63	2017-03-01	0	1	0	1
64	2017-01-01	0	1	0	0
64	2017-02-01	0	1	0	0
64	2017-03-01	0	1	0	0
65	2017-01-01	0	1	0	0
65	2017-02-01	0	1	0	0
65	2017-03-01	0	1	0	0
66	2017-01-01	0	1	0	0
66	2017-02-01	0	1	0	0
66	2017-03-01	0	1	0	0
67	2017-01-01	0	1	0	0
67	2017-02-01	0	1	0	0
67	2017-03-01	0	1	0	0
68	2017-01-01	1	0	1	0
68	2017-02-01	1	0	1	0
68	2017-03-01	1	0	1	0
69	2017-01-01	1	0	0	0
69	2017-02-01	1	0	1	0
69	2017-03-01	1	0	1	0
70	2017-01-01	1	0	0	0
70	2017-02-01	1	0	0	0
70	2017-03-01	1	0	1	0
71	2017-01-01	1	0	1	0
71	2017-02-01	1	0	1	0
71	2017-03-01	1	0	1	0
72	2017-01-01	1	0	1	0
72	2017-02-01	1	0	1	0
72	2017-03-01	1	0	1	0
73	2017-01-01	1	0	1	0
73	2017-02-01	1	0	1	0
73	2017-03-01	1	0	1	0
74	2017-01-01	1	0	1	0
74	2017-02-01	1	0	1	0
74	2017-03-01	1	0	1	0
75	2017-01-01	1	0	0	0
75	2017-02-01	1	0	1	0
75	2017-03-01	1	0	1	0
76	2017-01-01	1	0	1	0
76	2017-02-01	1	0	1	0
76	2017-03-01	1	0	1	0
77	2017-01-01	1	0	0	0
77	2017-02-01	1	0	1	0
77	2017-03-01	1	0	1	0
78	2017-01-01	1	0	1	0
78	2017-02-01	1	0	1	0
78	2017-03-01	1	0	1	0
79	2017-01-01	1	0	1	0
79	2017-02-01	1	0	1	0
79	2017-03-01	1	0	1	0
80	2017-01-01	1	0	1	0
80	2017-02-01	1	0	1	0
80	2017-03-01	1	0	1	0
81	2017-01-01	0	1	0	0
81	2017-02-01	0	1	0	0
81	2017-03-01	0	1	0	0
82	2017-01-01	0	1	0	0
82	2017-02-01	0	1	0	0
82	2017-03-01	0	1	0	0
83	2017-01-01	0	1	0	0
83	2017-02-01	0	1	0	0
83	2017-03-01	0	1	0	0
84	2017-01-01	0	1	0	0
84	2017-02-01	0	1	0	0
84	2017-03-01	0	1	0	0
85	2017-01-01	0	1	0	0
85	2017-02-01	0	1	0	0
85	2017-03-01	0	1	0	0
86	2017-01-01	0	1	0	1
86	2017-02-01	0	1	0	1
86	2017-03-01	0	1	0	1
87	2017-01-01	0	1	0	0
87	2017-02-01	0	1	0	0
87	2017-03-01	0	1	0	0
88	2017-01-01	0	1	0	0
88	2017-02-01	0	1	0	0
88	2017-03-01	0	1	0	1
89	2017-01-01	0	1	0	0
89	2017-02-01	0	1	0	0
89	2017-03-01	0	1	0	0
90	2017-01-01	1	0	0	0
90	2017-02-01	1	0	1	0
90	2017-03-01	1	0	1	0
91	2017-01-01	1	0	0	0
91	2017-02-01	1	0	0	0
91	2017-03-01	1	0	1	0
92	2017-01-01	1	0	0	0
92	2017-02-01	1	0	1	0
92	2017-03-01	1	0	1	0
93	2017-01-01	1	0	0	0
93	2017-02-01	1	0	1	0
93	2017-03-01	1	0	1	0
94	2017-01-01	1	0	1	0
94	2017-02-01	1	0	1	0
94	2017-03-01	1	0	1	0
95	2017-01-01	1	0	0	0
95	2017-02-01	1	0	1	0
95	2017-03-01	1	0	1	0
96	2017-01-01	1	0	0	0
96	2017-02-01	1	0	1	0
96	2017-03-01	1	0	1	0
97	2017-01-01	1	0	0	0
97	2017-02-01	1	0	0	0
97	2017-03-01	1	0	1	0
98	2017-01-01	1	0	0	0
98	2017-02-01	1	0	0	0
98	2017-03-01	1	0	1	0
99	2017-01-01	0	1	0	0
99	2017-02-01	0	1	0	0
99	2017-03-01	0	1	0	0
100	2017-01-01	0	1	0	0
100	2017-02-01	0	1	0	0
100	2017-03-01	0	1	0	1
101	2017-01-01	0	1	0	1
101	2017-02-01	0	1	0	1
101	2017-03-01	0	1	0	1
102	2017-01-01	0	1	0	1
102	2017-02-01	0	1	0	1
102	2017-03-01	0	1	0	1
103	2017-01-01	0	1	0	0
103	2017-02-01	0	1	0	0
103	2017-03-01	0	1	0	0
104	2017-01-01	0	1	0	0
104	2017-02-01	0	1	0	1
104	2017-03-01	0	1	0	1
105	2017-01-01	0	1	0	0
105	2017-02-01	0	1	0	0
105	2017-03-01	0	1	0	0
106	2017-01-01	0	1	0	0
106	2017-02-01	0	1	0	0
106	2017-03-01	0	1	0	1
107	2017-01-01	0	1	0	0
107	2017-02-01	0	1	0	0
107	2017-03-01	0	1	0	0
108	2017-01-01	0	1	0	0
108	2017-02-01	0	1	0	1
108	2017-03-01	0	1	0	1
109	2017-01-01	0	1	0	1
109	2017-02-01	0	1	0	1
109	2017-03-01	0	1	0	1
110	2017-01-01	1	0	0	0
110	2017-02-01	1	0	1	0
110	2017-03-01	1	0	1	0
111	2017-01-01	1	0	1	0
111	2017-02-01	1	0	1	0
111	2017-03-01	1	0	1	0
112	2017-01-01	1	0	1	0
112	2017-02-01	1	0	1	0
112	2017-03-01	1	0	1	0
113	2017-01-01	1	0	0	0
113	2017-02-01	1	0	0	0
113	2017-03-01	1	0	1	0
114	2017-01-01	1	0	0	0
114	2017-02-01	1	0	1	0
114	2017-03-01	1	0	1	0
115	2017-01-01	1	0	0	0
115	2017-02-01	1	0	1	0
115	2017-03-01	1	0	1	0
116	2017-01-01	1	0	0	0
116	2017-02-01	1	0	1	0
116	2017-03-01	1	0	1	0
117	2017-01-01	1	0	0	0
117	2017-02-01	1	0	1	0
117	2017-03-01	1	0	1	0
118	2017-01-01	1	0	0	0
118	2017-02-01	1	0	0	0
118	2017-03-01	1	0	1	0
119	2017-01-01	1	0	1	0
119	2017-02-01	1	0	1	0
119	2017-03-01	1	0	1	0
120	2017-01-01	0	1	0	0
120	2017-02-01	0	1	0	1
120	2017-03-01	0	1	0	1
121	2017-01-01	0	1	0	0
121	2017-02-01	0	1	0	1
121	2017-03-01	0	1	0	1
122	2017-01-01	0	1	0	0
122	2017-02-01	0	1	0	0
122	2017-03-01	0	1	0	0
123	2017-01-01	0	1	0	0
123	2017-02-01	0	1	0	0
123	2017-03-01	0	1	0	0
124	2017-01-01	0	1	0	0
124	2017-02-01	0	1	0	0
124	2017-03-01	0	1	0	0
125	2017-01-01	0	1	0	0
125	2017-02-01	0	1	0	0
125	2017-03-01	0	1	0	0
126	2017-01-01	0	1	0	0
126	2017-02-01	0	1	0	0
126	2017-03-01	0	1	0	0
127	2017-01-01	0	1	0	0
127	2017-02-01	0	1	0	0
127	2017-03-01	0	1	0	0
128	2017-01-01	0	1	0	0
128	2017-02-01	0	1	0	1
128	2017-03-01	0	1	0	1
129	2017-01-01	0	1	0	0
129	2017-02-01	0	1	0	0
129	2017-03-01	0	1	0	0
130	2017-01-01	0	1	0	0
130	2017-02-01	0	1	0	0
130	2017-03-01	0	1	0	0
131	2017-01-01	1	0	0	0
131	2017-02-01	1	0	1	0
131	2017-03-01	1	0	1	0
132	2017-01-01	1	0	1	0
132	2017-02-01	1	0	1	0
132	2017-03-01	1	0	1	0
133	2017-01-01	1	0	0	0
133	2017-02-01	1	0	0	0
133	2017-03-01	1	0	1	0
134	2017-01-01	1	0	0	0
134	2017-02-01	1	0	1	0
134	2017-03-01	1	0	1	0
135	2017-01-01	1	0	0	0
135	2017-02-01	1	0	0	0
135	2017-03-01	1	0	1	0
136	2017-01-01	1	0	0	0
136	2017-02-01	1	0	0	0
136	2017-03-01	1	0	1	0
137	2017-01-01	1	0	0	0
137	2017-02-01	1	0	0	0
137	2017-03-01	1	0	1	0
138	2017-01-01	1	0	1	0
138	2017-02-01	1	0	1	0
138	2017-03-01	1	0	1	0
139	2017-01-01	0	1	0	0
139	2017-02-01	0	1	0	0
139	2017-03-01	0	1	0	1
140	2017-01-01	0	1	0	1
140	2017-02-01	0	1	0	1
140	2017-03-01	0	1	0	1
141	2017-01-01	0	1	0	0
141	2017-02-01	0	1	0	0
141	2017-03-01	0	1	0	0
142	2017-01-01	0	1	0	0
142	2017-02-01	0	1	0	0
142	2017-03-01	0	1	0	1
143	2017-01-01	0	1	0	0
143	2017-02-01	0	1	0	0
143	2017-03-01	0	1	0	1
144	2017-01-01	0	1	0	0
144	2017-02-01	0	1	0	0
144	2017-03-01	0	1	0	0
145	2017-01-01	0	1	0	0
145	2017-02-01	0	1	0	0
145	2017-03-01	0	1	0	1
146	2017-01-01	0	1	0	0
146	2017-02-01	0	1	0	1
146	2017-03-01	0	1	0	1
147	2017-01-01	1	0	0	0
147	2017-02-01	1	0	0	0
147	2017-03-01	1	0	1	0
148	2017-01-01	1	0	0	0
148	2017-02-01	1	0	0	0
148	2017-03-01	1	0	1	0
149	2017-01-01	1	0	1	0
149	2017-02-01	1	0	1	0
149	2017-03-01	1	0	1	0
150	2017-01-01	1	0	0	0
150	2017-02-01	1	0	0	0
150	2017-03-01	1	0	1	0
151	2017-01-01	1	0	0	0
151	2017-02-01	1	0	0	0
151	2017-03-01	1	0	1	0
152	2017-01-01	1	0	1	0
152	2017-02-01	1	0	1	0
152	2017-03-01	1	0	1	0
153	2017-01-01	0	1	0	0
153	2017-02-01	0	1	0	0
153	2017-03-01	0	1	0	0
154	2017-01-01	0	1	0	0
154	2017-02-01	0	1	0	0
154	2017-03-01	0	1	0	0
155	2017-01-01	0	1	0	0
155	2017-02-01	0	1	0	1
155	2017-03-01	0	1	0	1
156	2017-01-01	0	1	0	0
156	2017-02-01	0	1	0	0
156	2017-03-01	0	1	0	0
157	2017-01-01	0	1	0	0
157	2017-02-01	0	1	0	1
157	2017-03-01	0	1	0	1
158	2017-01-01	0	1	0	0
158	2017-02-01	0	1	0	0
158	2017-03-01	0	1	0	0
159	2017-01-01	0	1	0	0
159	2017-02-01	0	1	0	0
159	2017-03-01	0	1	0	0
160	2017-01-01	0	1	0	0
160	2017-02-01	0	1	0	0
160	2017-03-01	0	1	0	1
161	2017-01-01	0	1	0	0
161	2017-02-01	0	1	0	0
161	2017-03-01	0	1	0	0
162	2017-01-01	0	1	0	0
162	2017-02-01	0	1	0	0
162	2017-03-01	0	1	0	0
163	2017-01-01	0	1	0	0
163	2017-02-01	0	1	0	0
163	2017-03-01	0	1	0	0
164	2017-01-01	0	1	0	0
164	2017-02-01	0	1	0	0
164	2017-03-01	0	1	0	0
165	2017-01-01	0	1	0	0
165	2017-02-01	0	1	0	0
165	2017-03-01	0	1	0	0
166	2017-01-01	0	1	0	0
166	2017-02-01	0	1	0	0
166	2017-03-01	0	1	0	0
167	2017-01-01	0	1	0	1
167	2017-02-01	0	1	0	1

#7 Status Aggregate
WITH months as
(SELECT
  '2017-01-01' as first_day,
  '2017-01-31' as last_day
UNION
SELECT
  '2017-02-01' as first_day,
  '2017-02-28' as last_day
UNION
SELECT
  '2017-03-01' as first_day,
  '2017-03-31' as last_day
),
cross_join AS
(SELECT *
FROM subscriptions
CROSS JOIN months),
status AS(
SELECT id, first_day AS 'Month',
CASE WHEN (segment = 87 AND first_day > subscription_start) THEN 1 ELSE 0 END as 'is_active_87',  
CASE WHEN (segment = 30 AND first_day > subscription_start) THEN 1 ELSE 0 END as 'is_active_30',
CASE WHEN (segment = 87 AND last_day > subscription_end) THEN 1 ELSE 0 END as 'is_canceled_87',
CASE WHEN (segment = 30 AND last_day > subscription_end) THEN 1 ELSE 0 END as 'is_canceled_30'
  FROM cross_join
),
status_aggregate as (
select sum(is_active_87) as'sum_active_87', sum(is_active_30) as 'sum_active_30', sum(is_canceled_87) as 'sum_canceled_87', sum(is_canceled_30) as 'sum_canceled_30'
 from status
)
Select * 
from status_aggregate;

sum_active_87	sum_active_30	sum_canceled_87	sum_canceled_30
1575	1609	743	221


WITH months as
(SELECT
  '2017-01-01' as first_day,
  '2017-01-31' as last_day
UNION
SELECT
  '2017-02-01' as first_day,
  '2017-02-28' as last_day
UNION
SELECT
  '2017-03-01' as first_day,
  '2017-03-31' as last_day
),
cross_join AS
(SELECT *
FROM subscriptions
CROSS JOIN months),
status AS(
SELECT id, first_day AS 'Month',
CASE WHEN (segment = 87 AND first_day > subscription_start) THEN 1 ELSE 0 END as 'is_active_87',  
CASE WHEN (segment = 30 AND first_day > subscription_start) THEN 1 ELSE 0 END as 'is_active_30',
CASE WHEN (segment = 87 AND last_day > subscription_end) THEN 1 ELSE 0 END as 'is_canceled_87',
CASE WHEN (segment = 30 AND last_day > subscription_end) THEN 1 ELSE 0 END as 'is_canceled_30'
  FROM cross_join
),
status_aggregate as (
select sum(is_active_87) as'sum_active_87', sum(is_active_30) as 'sum_active_30', sum(is_canceled_87) as 'sum_canceled_87', sum(is_canceled_30) as 'sum_canceled_30'
 from status
 )
select 1.0 * sum_canceled_87 / sum_active_87 as 'churn_rate_87', 1.0 * sum_canceled_30 / sum_active_30 as'churn_rate_30'
from status_aggregate;

churn_rate_87	churn_rate_30
0.471746031746032	0.137352392790553

